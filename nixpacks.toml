# Nixpacks configuration to explicitly use Python
# Following Nixpkgs Python conventions: https://nixos.org/manual/nixpkgs/stable/#python
# Nix manages Python environments, so we use venv to install packages
providers = ["python"]

[phases.setup]
# Use python311 from Nixpkgs
# venv is included with python311, no need to install pip separately
nixPkgs = ["python311"]

[phases.install]
# Create virtual environment to work around externally-managed-environment
# This is the recommended way to install packages in Nix-managed Python
cmds = [
  "python -m venv /app/venv",
  "/app/venv/bin/pip install --upgrade pip",
  "/app/venv/bin/pip install -r backend/requirements.txt"
]

[phases.build]
cmds = []

[start]
# Use Python from venv
cmd = "/app/venv/bin/python backend/main.py"

